<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/styles.css">
    <title>Trip Cost Calculator</title>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-logo">
                <img src="./assets/img/logo.svg" alt="Logo">
            </div>
            <div class="header-menu">
                <button class="menu-button" id="menuButton">
                    <span class="hamburger"></span>
                </button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="menu-item menu-user" id="menuUser" style="display: none;">user@example.com</div>
                    <button class="menu-item" id="menuSignIn">Sign In</button>
                    <button class="menu-item" id="menuEstimates" style="display: none;">Estimates</button>
                    <button class="menu-item" id="menuDefaults">Defaults</button>
                    <button class="menu-item" id="menuSignOut" style="display: none;">Sign Out</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <h1>Trip Cost Calculator</h1>

        <!-- Section 1: Flight Legs -->
        <section class="section">
            <h2>Flight Legs</h2>
            <div id="flightLegsContainer"></div>
            <button class="btn-secondary" id="addLegButton" tabindex="0">Add Leg</button>
        </section>

        <!-- Section 2: Fuel & Operations -->
        <section class="section">
            <h2>Fuel & Operations</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="fuelPrice">Fuel Price ($/gallon)</label>
                    <input type="number" id="fuelPrice" step="0.01" min="0" value="5.93" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="fuelDensity">Fuel Density (lbs/gallon)</label>
                    <input type="number" id="fuelDensity" step="0.1" min="0" value="6.7" inputmode="decimal">
                </div>
            </div>
            <div class="form-field" style="margin-top: var(--spacing-md);">
                <label>
                    <input type="checkbox" id="includeAPU">
                    Include APU Burn
                </label>
            </div>
        </section>

        <!-- Section 3: Crew Day Rates -->
        <section class="section">
            <h2>Crew Day Rates</h2>
            <div id="crewContainer"></div>
            <button class="btn-secondary" id="addCrewButton" tabindex="0">Add Role</button>
        </section>

        <!-- Section 4: Crew Expenses -->
        <section class="section">
            <h2>Crew Expenses</h2>

            <h3>Trip Duration</h3>
            <div class="form-grid">
                <div class="form-field">
                    <label for="tripDays">Trip Days</label>
                    <input type="number" id="tripDays" min="0" value="0" inputmode="numeric">
                </div>
                <div class="form-field">
                    <label for="hotelStays">Hotel Stays (nights)</label>
                    <input type="number" id="hotelStays" min="0" value="0" inputmode="numeric">
                </div>
            </div>

            <h3>Per Person Expenses</h3>
            <div class="form-grid">
                <div class="form-field">
                    <label for="hotelRate">Hotel ($/night/person)</label>
                    <input type="number" id="hotelRate" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="mealsRate">Meals ($/day/person)</label>
                    <input type="number" id="mealsRate" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherRate">Other ($/day/person)</label>
                    <input type="number" id="otherRate" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>

            <h3>Total Trip Expenses</h3>
            <div class="form-grid">
                <div class="form-field">
                    <label for="rentalCar">Rental Car ($)</label>
                    <input type="number" id="rentalCar" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="airfare">Airfare ($)</label>
                    <input type="number" id="airfare" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="mileage">Mileage ($)</label>
                    <input type="number" id="mileage" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 5: Hourly Programs & Reserves -->
        <section class="section">
            <h2>Hourly Programs & Reserves</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="maintenancePrograms">Maintenance Programs ($/hour)</label>
                    <input type="number" id="maintenancePrograms" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherConsumables">Other Consumables ($/hour)</label>
                    <input type="number" id="otherConsumables" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="additionalHourly">Additional ($/hour)</label>
                    <input type="number" id="additionalHourly" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 6: Airport & Ground Costs -->
        <section class="section">
            <h2>Airport & Ground Costs</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="landingFees">Landing Fees ($)</label>
                    <input type="number" id="landingFees" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="catering">Catering ($)</label>
                    <input type="number" id="catering" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="handling">Handling ($)</label>
                    <input type="number" id="handling" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="passengerTransport">Passenger Ground Transport ($)</label>
                    <input type="number" id="passengerTransport" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="facilityFees">Facility Fees ($)</label>
                    <input type="number" id="facilityFees" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="specialEventFees">Special Event Fees ($)</label>
                    <input type="number" id="specialEventFees" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="rampParking">Ramp/Parking ($)</label>
                    <input type="number" id="rampParking" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="customs">Customs ($)</label>
                    <input type="number" id="customs" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="hangar">Hangar ($)</label>
                    <input type="number" id="hangar" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherAirport">Other ($)</label>
                    <input type="number" id="otherAirport" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 7: Miscellaneous -->
        <section class="section">
            <h2>Miscellaneous</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="tripCoordinationFee">Trip Coordination Fee ($)</label>
                    <input type="number" id="tripCoordinationFee" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherMisc">Other ($)</label>
                    <input type="number" id="otherMisc" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 8: Trip Notes -->
        <section class="section">
            <h2>Trip Notes</h2>
            <textarea id="tripNotes" rows="4" placeholder="Optional notes about the trip (e.g., client preferences, special handling, overnight particulars)"></textarea>
        </section>

        <!-- Section 9: Trip Estimate -->
        <section class="section">
            <h2>Trip Estimate</h2>
            <pre id="tripEstimate">Add flight legs to see estimate...</pre>
        </section>

        <!-- Footer Buttons -->
        <footer class="footer-buttons">
            <button class="btn-primary" id="copyButton">Copy to Clipboard</button>
            <button class="btn-primary" id="exportPdfButton">Export to PDF</button>
            <button class="btn-primary" id="saveEstimateButton">Save Estimate</button>
            <button class="btn-primary" id="loadEstimateButton">Load Estimate</button>
            <button class="btn-secondary" id="resetButton">Reset</button>
        </footer>
    </main>

    <!-- Defaults Modal -->
    <div class="modal" id="defaultsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Defaults</h2>
                <button class="modal-close" id="closeDefaultsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label for="defaultFuelPrice">Fuel Price ($/gallon)</label>
                    <input type="number" id="defaultFuelPrice" step="0.01" min="0" value="5.93" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultFuelDensity">Fuel Density (lbs/gallon)</label>
                    <input type="number" id="defaultFuelDensity" step="0.1" min="0" value="6.7" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultPilotRate">Pilot Daily Rate ($)</label>
                    <input type="number" id="defaultPilotRate" step="0.01" min="0" value="1500" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultAttendantRate">Flight Attendant Daily Rate ($)</label>
                    <input type="number" id="defaultAttendantRate" step="0.01" min="0" value="800" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultHotelRate">Hotel ($/night/person)</label>
                    <input type="number" id="defaultHotelRate" step="0.01" min="0" value="200" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultMealsRate">Meals ($/day/person)</label>
                    <input type="number" id="defaultMealsRate" step="0.01" min="0" value="100" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultMaintenanceRate">Maintenance Programs ($/hour)</label>
                    <input type="number" id="defaultMaintenanceRate" step="0.01" min="0" value="1048.42" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultAPUBurn">APU Burn (lbs/leg)</label>
                    <input type="number" id="defaultAPUBurn" min="0" value="100" inputmode="numeric">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelDefaultsButton">Cancel</button>
                <button class="btn-primary" id="saveDefaultsButton">Save Defaults</button>
            </div>
        </div>
    </div>

    <!-- Load Estimate Modal -->
    <div class="modal" id="loadEstimateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Load Estimate</h2>
                <button class="modal-close" id="closeLoadEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="savedEstimatesList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelLoadButton">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal" id="signInModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sign In</h2>
                <button class="modal-close" id="closeSignInModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="signInForm">
                    <div class="form-field">
                        <label for="signInEmail">Email</label>
                        <input type="email" id="signInEmail" required autocomplete="email">
                    </div>
                    <div class="form-field">
                        <label for="signInPassword">Password</label>
                        <input type="password" id="signInPassword" required autocomplete="current-password">
                    </div>
                    <div id="signInError" class="error-message" style="display: none;"></div>
                    <div style="margin-top: var(--spacing-md);">
                        <button type="button" class="btn-link" id="forgotPasswordLink">Forgot Password?</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelSignInButton">Cancel</button>
                <button type="submit" class="btn-primary" id="signInButton" form="signInForm">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal" id="passwordResetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Password</h2>
                <button class="modal-close" id="closePasswordResetModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your email address and we'll send you a link to reset your password.</p>
                <form id="passwordResetForm">
                    <div class="form-field">
                        <label for="resetEmail">Email</label>
                        <input type="email" id="resetEmail" required autocomplete="email">
                    </div>
                    <div id="resetError" class="error-message" style="display: none;"></div>
                    <div id="resetSuccess" class="success-message" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelPasswordResetButton">Cancel</button>
                <button type="submit" class="btn-primary" id="sendResetButton" form="passwordResetForm">Send Reset Link</button>
            </div>
        </div>
    </div>

    <!-- Save Estimate Modal -->
    <div class="modal" id="saveEstimateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="saveEstimateModalTitle">Save Estimate</h2>
                <button class="modal-close" id="closeSaveEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="saveEstimateForm">
                    <div class="form-field">
                        <label for="estimateName">Estimate Name</label>
                        <input type="text" id="estimateName" required placeholder="e.g., Miami to New York - June 2024" autofocus>
                    </div>
                    <div id="saveEstimateError" class="error-message" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelSaveEstimateButton">Cancel</button>
                <button type="submit" class="btn-primary" id="confirmUpdateEstimateButton" form="saveEstimateForm" style="display: none;">Update</button>
                <button type="submit" class="btn-primary" id="confirmSaveEstimateButton" form="saveEstimateForm">Save as New</button>
            </div>
        </div>
    </div>

    <!-- Share Estimate Modal -->
    <div class="modal" id="shareEstimateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Estimate</h2>
                <button class="modal-close" id="closeShareEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Share this estimate with others. They can view it and copy it to their own account for editing.</p>
                <div class="form-field">
                    <label for="shareLink">Share Link</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="shareLink" readonly style="flex: 1;">
                        <button class="btn-secondary" id="copyShareLinkButton">Copy</button>
                    </div>
                </div>
                <div id="shareError" class="error-message" style="display: none;"></div>
                <div id="shareSuccess" class="success-message" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="closeShareModalButton">Close</button>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="resetConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Form</h2>
                <button class="modal-close" id="closeResetConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reset the form? This will clear all data including:</p>
                <ul style="margin: 1rem 0; padding-left: 2rem;">
                    <li>All flight legs</li>
                    <li>All crew members</li>
                    <li>Trip details and notes</li>
                    <li>Any unsaved changes</li>
                </ul>
                <p><strong>This action cannot be undone.</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelResetButton">Cancel</button>
                <button type="button" class="btn-danger" id="confirmResetButton">Reset Form</button>
            </div>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div class="modal" id="pdfPreviewModal">
        <div class="modal-content modal-content-large">
            <div class="modal-header">
                <h2>PDF Preview</h2>
                <button type="button" class="modal-close" id="closePdfPreviewModal">&times;</button>
            </div>
            <div class="modal-body modal-body-pdf">
                <iframe id="pdfPreviewFrame"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="closePdfPreviewButton">Close</button>
                <button type="button" class="btn-primary" id="downloadPdfButton">Download PDF</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="module" src="./assets/js/app.js"></script>
</body>
</html>
