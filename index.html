<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/styles.css">
    <title>Trip Cost Calculator</title>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-logo">
                <a href="/" id="logoLink">
                    <img src="./assets/img/logo.svg" alt="Logo">
                </a>
            </div>

            <!-- Desktop Navigation -->
            <nav class="desktop-nav" id="desktopNav">
                <button type="button" class="nav-link" id="desktopDefaults">Defaults</button>
                <button type="button" class="nav-link" id="desktopEstimates" style="display: none;">My Estimates</button>
                <button type="button" class="nav-link" id="desktopSignIn">Sign In</button>

                <!-- User dropdown for desktop -->
                <div class="user-dropdown" id="desktopUserDropdown" style="display: none;">
                    <button type="button" class="user-dropdown-button" id="desktopUserButton">
                        <span id="desktopUserEmail">user@example.com</span>
                        <span class="dropdown-arrow">â–¾</span>
                    </button>
                    <div class="user-dropdown-menu" id="desktopUserMenu">
                        <button type="button" class="user-dropdown-item" id="desktopSignOut">Sign Out</button>
                    </div>
                </div>
            </nav>

            <!-- Mobile Menu -->
            <div class="header-menu">
                <button class="menu-button" id="menuButton">
                    <span class="hamburger"></span>
                </button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="menu-item menu-user" id="menuUser" style="display: none;">user@example.com</div>
                    <button class="menu-item" id="menuSignIn">Sign In</button>
                    <button class="menu-item" id="menuEstimates" style="display: none;">Estimates</button>
                    <button class="menu-item" id="menuDefaults">Defaults</button>
                    <button class="menu-item" id="menuSignOut" style="display: none;">Sign Out</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <h1 id="mainHeading">Trip Cost Calculator</h1>

        <!-- Share View: Read-Only Presentation (hidden by default) -->
        <div id="shareView" class="share-view" style="display: none;">
            <!-- Beautiful formatted estimate display -->
            <div id="shareEstimateDisplay" class="share-estimate-beautiful"></div>

            <div class="share-actions">
                <button class="btn-primary btn-large" id="shareExportPDF">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="16" height="16" fill="currentColor" style="margin-right: 8px;">
                        <path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM216 232V334.1l31-31c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-72 72c-9.4 9.4-24.6 9.4-33.9 0l-72-72c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l31 31V232c0-13.3 10.7-24 24-24s24 10.7 24 24z"/>
                    </svg>
                    Export to PDF
                </button>

                <button class="btn-secondary btn-large" id="shareEstimateButton">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="currentColor" style="margin-right: 8px;">
                        <path d="M307 34.8c-11.5 5.1-19 16.6-19 29.2v64H176C78.8 128 0 206.8 0 304C0 417.3 81.5 467.9 100.2 478.1c2.5 1.4 5.3 1.9 8.1 1.9c10.9 0 19.7-8.9 19.7-19.7c0-7.5-4.3-14.4-9.8-19.5C108.8 431.9 96 414.4 96 384c0-53 43-96 96-96h96v64c0 12.6 7.4 24.1 19 29.2s25 3 34.4-5.4l160-144c6.7-6.1 10.6-14.7 10.6-23.8s-3.8-17.7-10.6-23.8l-160-144c-9.4-8.5-22.9-10.6-34.4-5.4z"/>
                    </svg>
                    Share
                </button>

                <div class="share-signin-cta">
                    <p>Want to save or modify this estimate?</p>
                    <button class="btn-secondary" id="shareSignInButton">Sign in to save estimate</button>
                </div>
            </div>

            <!-- Legal Disclaimer -->
            <div class="legal-disclaimer">
                <p><strong>Disclaimer:</strong> The trip estimates generated by this tool are provided solely for planning purposes in connection with properly documented <strong>dry lease</strong> and/or cost-sharing arrangements under 14 C.F.R. Part 91. These estimates reflect <em>approximate direct operating costs</em> only and do not constitute a charter quote, an offer of air transportation to the public, or operations under 14 C.F.R. Part 135.</p>
            </div>

            <div class="share-footer-link">
                <p>Want to create your own estimate? <a href="/" id="createOwnEstimateLink">Start here</a></p>
            </div>
        </div>

        <!-- Normal View: Editable Form (shown by default) -->
        <div id="normalView">
        <!-- Section 1: Flight Legs -->
        <section class="section">
            <h2>Flight Legs</h2>
            <div id="flightLegsContainer"></div>
            <button class="btn-secondary" id="addLegButton" tabindex="0">Add Leg</button>
        </section>

        <!-- Section 2: Fuel & Operations -->
        <section class="section">
            <h2>Fuel & Operations</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="fuelPrice">Fuel Price ($/gallon)</label>
                    <input type="number" id="fuelPrice" step="0.01" min="0" value="5.93" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="fuelDensity">Fuel Density (lbs/gallon)</label>
                    <input type="number" id="fuelDensity" step="0.1" min="0" value="6.7" inputmode="decimal">
                </div>
            </div>
            <div class="form-field" style="margin-top: var(--spacing-md);">
                <label>
                    <input type="checkbox" id="includeAPU">
                    Include APU Burn
                </label>
            </div>
        </section>

        <!-- Section 3: Crew Day Rates -->
        <section class="section">
            <h2>Crew Day Rates</h2>
            <div id="crewContainer"></div>
            <button class="btn-secondary" id="addCrewButton" tabindex="0">Add Role</button>
        </section>

        <!-- Section 4: Crew Expenses -->
        <section class="section">
            <h2>Crew Expenses</h2>

            <h3>Trip Duration</h3>
            <div class="form-grid">
                <div class="form-field">
                    <label for="tripDays">Trip Days</label>
                    <input type="number" id="tripDays" min="0" value="0" inputmode="numeric">
                </div>
                <div class="form-field">
                    <label for="hotelStays">Hotel Stays (nights)</label>
                    <input type="number" id="hotelStays" min="0" value="0" inputmode="numeric">
                </div>
            </div>

            <h3>Per Person Expenses</h3>
            <div class="form-grid">
                <div class="form-field">
                    <label for="hotelRate">Hotel ($/night/person)</label>
                    <input type="number" id="hotelRate" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="mealsRate">Meals ($/day/person)</label>
                    <input type="number" id="mealsRate" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherRate">Other ($/day/person)</label>
                    <input type="number" id="otherRate" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>

            <h3>Flat Rate Expenses</h3>
            <div class="form-grid">
                <div class="form-field">
                    <label for="rentalCar">Rental Car ($)</label>
                    <input type="number" id="rentalCar" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="airfare">Airfare ($)</label>
                    <input type="number" id="airfare" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="mileage">Mileage ($)</label>
                    <input type="number" id="mileage" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 5: Hourly Programs & Reserves -->
        <section class="section">
            <h2>Hourly Programs & Reserves</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="maintenancePrograms">Maintenance Programs ($/hour)</label>
                    <input type="number" id="maintenancePrograms" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherConsumables">Other Consumables ($/hour)</label>
                    <input type="number" id="otherConsumables" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="additionalHourly">Additional ($/hour)</label>
                    <input type="number" id="additionalHourly" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 6: Airport & Ground Costs -->
        <section class="section">
            <h2>Airport & Ground Costs</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="landingFees">Landing Fees ($)</label>
                    <input type="number" id="landingFees" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="catering">Catering ($)</label>
                    <input type="number" id="catering" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="handling">Handling ($)</label>
                    <input type="number" id="handling" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="passengerTransport">Passenger Ground Transport ($)</label>
                    <input type="number" id="passengerTransport" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="facilityFees">Facility Fees ($)</label>
                    <input type="number" id="facilityFees" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="specialEventFees">Special Event Fees ($)</label>
                    <input type="number" id="specialEventFees" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="rampParking">Ramp/Parking ($)</label>
                    <input type="number" id="rampParking" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="customs">Customs ($)</label>
                    <input type="number" id="customs" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="hangar">Hangar ($)</label>
                    <input type="number" id="hangar" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherAirport">Other ($)</label>
                    <input type="number" id="otherAirport" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 7: Miscellaneous -->
        <section class="section">
            <h2>Miscellaneous</h2>
            <div class="form-grid">
                <div class="form-field">
                    <label for="tripCoordinationFee">Trip Coordination Fee ($)</label>
                    <input type="number" id="tripCoordinationFee" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="otherMisc">Other ($)</label>
                    <input type="number" id="otherMisc" step="0.01" min="0" value="0" inputmode="decimal">
                </div>
            </div>
        </section>

        <!-- Section 8: Trip Notes -->
        <section class="section">
            <h2>Trip Notes</h2>
            <textarea id="tripNotes" rows="4" placeholder="Optional notes about the trip (e.g., client preferences, special handling, overnight particulars)"></textarea>
        </section>

        <!-- Section 9: Trip Estimate -->
        <section class="section">
            <h2>Trip Estimate</h2>
            <pre id="tripEstimate">Add flight legs to see estimate...</pre>
        </section>

        <!-- Sign In Tip (shown only when not authenticated) -->
        <div class="auth-tip" id="authTip" style="display: none;">
            <svg class="auth-tip-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor">
                <path d="M320 112C434.9 112 528 205.1 528 320C528 434.9 434.9 528 320 528C205.1 528 112 434.9 112 320C112 205.1 205.1 112 320 112zM320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM280 400C266.7 400 256 410.7 256 424C256 437.3 266.7 448 280 448L360 448C373.3 448 384 437.3 384 424C384 410.7 373.3 400 360 400L352 400L352 312C352 298.7 341.3 288 328 288L280 288C266.7 288 256 298.7 256 312C256 325.3 266.7 336 280 336L304 336L304 400L280 400zM320 256C337.7 256 352 241.7 352 224C352 206.3 337.7 192 320 192C302.3 192 288 206.3 288 224C288 241.7 302.3 256 320 256z"/>
            </svg>
            <span>Tip: <button type="button" class="auth-tip-link" id="authTipSignIn">Sign in</button> to save and load estimates across devices</span>
        </div>

        <!-- Footer Buttons -->
        <footer class="footer-buttons">
            <button class="btn-primary" id="shareButton">Share</button>
            <button class="btn-primary" id="exportPDFButton">Export to PDF</button>
            <button class="btn-primary" id="saveEstimateButton">Save Estimate</button>
            <button class="btn-primary" id="loadEstimateButton">Load Estimate</button>
            <button class="btn-secondary" id="resetButton">Reset</button>
        </footer>

        <!-- Legal Disclaimer -->
        <div class="legal-disclaimer">
            <p><strong>Disclaimer:</strong> The trip estimates generated by this tool are provided solely for planning purposes in connection with properly documented <strong>dry lease</strong> and/or cost-sharing arrangements under 14 C.F.R. Part 91. These estimates reflect <em>approximate direct operating costs</em> only and do not constitute a charter quote, an offer of air transportation to the public, or operations under 14 C.F.R. Part 135.</p>
        </div>
        </div><!-- End normalView -->
    </main>

    <!-- Defaults Modal -->
    <div class="modal" id="defaultsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Defaults</h2>
                <button class="modal-close" id="closeDefaultsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label for="defaultFuelPrice">Fuel Price ($/gallon)</label>
                    <input type="number" id="defaultFuelPrice" step="0.01" min="0" value="5.93" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultFuelDensity">Fuel Density (lbs/gallon)</label>
                    <input type="number" id="defaultFuelDensity" step="0.1" min="0" value="6.7" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultPilotRate">Pilot Daily Rate ($)</label>
                    <input type="number" id="defaultPilotRate" step="0.01" min="0" value="1500" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultAttendantRate">Flight Attendant Daily Rate ($)</label>
                    <input type="number" id="defaultAttendantRate" step="0.01" min="0" value="800" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultHotelRate">Hotel ($/night/person)</label>
                    <input type="number" id="defaultHotelRate" step="0.01" min="0" value="200" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultMealsRate">Meals ($/day/person)</label>
                    <input type="number" id="defaultMealsRate" step="0.01" min="0" value="100" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultMaintenanceRate">Maintenance Programs ($/hour)</label>
                    <input type="number" id="defaultMaintenanceRate" step="0.01" min="0" value="1048.42" inputmode="decimal">
                </div>
                <div class="form-field">
                    <label for="defaultAPUBurn">APU Burn (lbs/leg)</label>
                    <input type="number" id="defaultAPUBurn" min="0" value="100" inputmode="numeric">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelDefaultsButton">Cancel</button>
                <button class="btn-primary" id="saveDefaultsButton">Save Defaults</button>
            </div>
        </div>
    </div>

    <!-- Load Estimate Modal -->
    <div class="modal" id="loadEstimateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Load Estimate</h2>
                <button class="modal-close" id="closeLoadEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="savedEstimatesList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelLoadButton">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal" id="signInModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sign In</h2>
                <button class="modal-close" id="closeSignInModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="signInForm">
                    <div class="form-field">
                        <label for="signInEmail">Email</label>
                        <input type="email" id="signInEmail" required autocomplete="email">
                    </div>
                    <div class="form-field">
                        <label for="signInPassword">Password</label>
                        <input type="password" id="signInPassword" required autocomplete="current-password">
                    </div>
                    <div id="signInError" class="error-message" style="display: none;"></div>
                    <div style="margin-top: var(--spacing-md);">
                        <button type="button" class="btn-link" id="forgotPasswordLink">Forgot Password?</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelSignInButton">Cancel</button>
                <button type="submit" class="btn-primary" id="signInButton" form="signInForm">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal" id="passwordResetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Password</h2>
                <button class="modal-close" id="closePasswordResetModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your email address and we'll send you a link to reset your password.</p>
                <form id="passwordResetForm">
                    <div class="form-field">
                        <label for="resetEmail">Email</label>
                        <input type="email" id="resetEmail" required autocomplete="email">
                    </div>
                    <div id="resetError" class="error-message" style="display: none;"></div>
                    <div id="resetSuccess" class="success-message" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelPasswordResetButton">Cancel</button>
                <button type="submit" class="btn-primary" id="sendResetButton" form="passwordResetForm">Send Reset Link</button>
            </div>
        </div>
    </div>

    <!-- Update Password Modal (after clicking reset link) -->
    <div class="modal" id="updatePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set New Password</h2>
                <button class="modal-close" id="closeUpdatePasswordModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Please enter your new password.</p>
                <form id="updatePasswordForm">
                    <!-- Hidden email field for password managers to associate username with password -->
                    <input type="email" id="resetUserEmail" autocomplete="username" style="display: none;" tabindex="-1" aria-hidden="true">
                    <div class="form-field">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" required autocomplete="new-password" minlength="6">
                    </div>
                    <div class="form-field">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" required autocomplete="new-password" minlength="6">
                    </div>
                    <div id="updatePasswordError" class="error-message" style="display: none;"></div>
                    <div id="updatePasswordSuccess" class="success-message" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelUpdatePasswordButton">Cancel</button>
                <button type="submit" class="btn-primary" id="updatePasswordButton" form="updatePasswordForm">Update Password</button>
            </div>
        </div>
    </div>

    <!-- Save Estimate Modal -->
    <div class="modal" id="saveEstimateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="saveEstimateModalTitle">Save Estimate</h2>
                <button class="modal-close" id="closeSaveEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="saveEstimateForm">
                    <div class="form-field">
                        <label for="estimateName">Estimate Name</label>
                        <input type="text" id="estimateName" required placeholder="e.g., Miami to New York - June 2024" autofocus>
                    </div>
                    <div id="saveEstimateError" class="error-message" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelSaveEstimateButton">Cancel</button>
                <button type="submit" class="btn-primary" id="confirmUpdateEstimateButton" form="saveEstimateForm" style="display: none;">Update</button>
                <button type="submit" class="btn-primary" id="confirmSaveEstimateButton" form="saveEstimateForm">Save as New</button>
            </div>
        </div>
    </div>

    <!-- Share Estimate Modal -->
    <div class="modal" id="shareEstimateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Estimate</h2>
                <button class="modal-close" id="closeShareEstimateModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Share this estimate with others. They can view it and copy it to their own account for editing.</p>
                <div class="form-field">
                    <label for="shareLink">Share Link</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="shareLink" readonly style="flex: 1;">
                        <button class="btn-secondary" id="copyShareLinkButton">Copy</button>
                    </div>
                </div>
                <div id="shareError" class="error-message" style="display: none;"></div>
                <div id="shareSuccess" class="success-message" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="closeShareModalButton">Close</button>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="resetConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reset Form</h2>
                <button class="modal-close" id="closeResetConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reset the form? This will clear all data including:</p>
                <ul style="margin: 1rem 0; padding-left: 2rem;">
                    <li>All flight legs</li>
                    <li>All crew members</li>
                    <li>Trip details and notes</li>
                    <li>Any unsaved changes</li>
                </ul>
                <p><strong>This action cannot be undone.</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelResetButton">Cancel</button>
                <button type="button" class="btn-danger" id="confirmResetButton">Reset Form</button>
            </div>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div class="modal" id="pdfPreviewModal">
        <div class="modal-content modal-content-large">
            <div class="modal-header">
                <h2>PDF Preview</h2>
                <button type="button" class="modal-close" id="closePdfPreviewModal">&times;</button>
            </div>
            <div class="modal-body modal-body-pdf">
                <iframe id="pdfPreviewFrame"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="closePdfPreviewButton">Close</button>
                <button type="button" class="btn-primary" id="downloadPdfButton">Download PDF</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Share Modal -->
    <div class="modal" id="enhancedShareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Estimate</h2>
                <button type="button" class="modal-close" id="closeEnhancedShareModal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: var(--spacing-lg); color: var(--color-text-secondary);">
                    Choose how you'd like to share this estimate
                </p>

                <div class="share-options">
                    <button class="share-option-btn" id="shareViaEmailBtn">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span class="share-option-label">Email Estimate</span>
                        <span class="share-option-desc">Open email with estimate</span>
                    </button>

                    <button class="share-option-btn" id="shareViaCopyBtn">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span class="share-option-label">Copy to Clipboard</span>
                        <span class="share-option-desc">Copy text for any app</span>
                    </button>

                    <button class="share-option-btn" id="shareViaLinkBtn" style="display: none;">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                        </svg>
                        <span class="share-option-label">Copy Shareable Link</span>
                        <span class="share-option-desc">Interactive estimate link</span>
                    </button>

                    <button class="share-option-btn" id="shareViaNativeBtn" style="display: none;">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                        </svg>
                        <span class="share-option-label">Share via...</span>
                        <span class="share-option-desc">Use device share menu</span>
                    </button>
                </div>

                <div id="enhancedShareSuccess" class="success-message" style="display: none; margin-top: var(--spacing-md);"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="closeEnhancedShareButton">Close</button>
            </div>
        </div>
    </div>

    <!-- Client Share Modal (for share view only) -->
    <div class="modal" id="clientShareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Share Estimate</h2>
                <button type="button" class="modal-close" id="closeClientShareModal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: var(--spacing-lg); color: var(--color-text-secondary);">
                    Choose how you'd like to share this estimate
                </p>

                <div class="share-options">
                    <button class="share-option-btn" id="clientShareEmailBtn">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span class="share-option-label">Email Estimate</span>
                        <span class="share-option-desc">Open email with estimate</span>
                    </button>

                    <button class="share-option-btn" id="clientShareCopyBtn">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span class="share-option-label">Copy to Clipboard</span>
                        <span class="share-option-desc">Copy text for any app</span>
                    </button>

                    <button class="share-option-btn" id="clientShareViaBtn">
                        <svg class="share-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                        </svg>
                        <span class="share-option-label">Share via...</span>
                        <span class="share-option-desc">Use your device's share menu</span>
                    </button>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="closeClientShareButton">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="module" src="./assets/js/app.js"></script>
</body>
</html>
